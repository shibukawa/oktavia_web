========
Tutorial
========

Oktavia has many components:

* Command-line tool (generating index files, search).
* Customizable parts for programmers.
* JavaScript libraries.

On this document, try this engine by using command line tools.

Download
========

Download Oktavia tools and libraries from github.

* https://github.com/shibukawa/oktavia

It needs node.js. Version 0.8.21 is confirmed to run. Before running commands, install node.js.
`node.js website <http://nodejs.org/download/>`_ provides detail informations to install node.js to any platforms.

Oktavia provides a simple tool ``httpstatus``. It is a utility program to check HTTP status code. It is in ``bin`` folder.
Use like this:

.. code-block:: bash

   $ bin/httpstatus 30
   300: Multiple Choices
   301: Moved Permanently
   302: Found
   303: See Other
   304: Not Modified
   305: Use Proxy

It returns status code that includes "30".

Oktavia provides Google style search query syntax, except number ranging queries:

* All words: ``word1 word2``
* Exact words or phrase: ``"word1 word2"``
* Any of these words: ``word1 OR word2``
* None of these words: ``-word1``

For example, the following query returns lines that contain "40" and don't contain "not":

.. code-block:: javascript

   $ ./httpstatus 40 -not
   400: Bad Request
   401: Unauthorized
   402: Payment Required
   403: Forbidden
   407: Proxy Authentication Required
   408: Request Timeout
   409: Conflict

What is Happening Behind Search Engine?
=======================================

Inside search engines, there are following steps behind them:

* Create an index file from source text.

  * Read source contents.
  * Store an index file.

* Search content and show result.

  * Read an index file.
  * Receive and parse a user query.
  * Search words.
  * Summarise each word's result.
  * Show result.

``httpstatus`` is simple but it contains all parts of the search engine.

Create Your own Index File
==========================

Now Oktavia provides an index generator tool from HTML document, ``oktavia-mkindex``. Let's try creating index of Python document. Before trying this, you should install Mercurial.

You can clone Python's repository like this:

.. code-block:: bash

   $ hg clone http://hg.python.org/cpython

After cloning Python source code, let's build HTML document like following:

.. code-block:: bash

   $ cd cpython/Doc
   $ make html
   (wait)

Result HTML files are in a ``cpython/Doc/build/html`` folder. To create an index file, it needs following information.

* Input files: ``cpython/Doc/build/html``
* Document root: ``cpython/Doc/build/html``
* Mode: ``html``
* Search-unit: ``file``, ``h1`` etc...
* Filter: HTML tag, id, class etc...
* Cache Density(%).

Input files are accept each files or folders. The ``oktavia-mkindex`` can accept several inputs at the same time by using ``-i`` or ``--input`` parameters. You should select only pages that content valuable information.
Python document contains index pages. These pages don't have information itself.

Document root is an important for index file for web browsers. An index file stores relative path from this path to each files.

Python has a file ``library/os.html`` in ``cpython/Doc/build/html``. Following table is a sample of the document root option:

.. list-table::
   :header-rows: 1

   - * Document Root
     * Result Path
   - * ``cpython/Doc/build/html``
     * ``/library/os.html``
   - * ``cpython/Doc/build/html/library``
     * ``/os.html``

Use ``-r`` or ``--root`` option to specify a document root.

Current version of Oktavia only support HTML as a mode. Use ``-m html``.

A search-unit specifies grain sizes of information. If ``file`` is specified as a search-unit, summarizer binds found words in a same page.
If ``h1`` is specified, result is separated by the heading level. Let ``oktavia-mkindex`` know a search-unit by using ``-u`` or ``--unit`` option.

A filter is an important to reduce noise from search results. HTML files contains header, sidebar, footer and so on. Each Python document have a ``<div class="body">`` tag. Outside of this tag is a content generated by the HTML template. These contents should not be in a search index. ``oktavia-mkindex`` will ignore them if you pass ``-f .body`` or ``--filter .body`` option to ``oktavia-mkindex``.

A cache density effect the result file size and performance. Default value is "5" (%). A cache density and a cache size are increase commensurately and a search response time is in inverse proportion to them.
Python document contains 10MB texts in UTF-16 (it is a text encoding used in JavaScript). If you use "5", resulting cache size become 4MB.

If total file size are bigger than 10MB and you want to provide searching feature for browser, you should use 1 or 2 or less. If you set bigger value like 25, you can feel amazing speed.

You can create index file like this:

.. code-block:: bash

  $ bin/oktavia-mkindex -i cpython/Doc/build/html/library -i cpython/Doc/build/html/c-api
    -i cpython/Doc/build/html/reference -i cpython/Doc/build/html/tutorial
    -r cpython/Doc/build/html -m html -u h2 -f .body -c 5

It takes about 20 seconds on my computer.

You get a search index file in ``cpython/Doc/build/html/search/searchindex.okt``. It contains information about "Language Reference", "Library Reference", "C-API" and "Python Tutorial".

Search words on Your Index File
===============================

Oktavia provides search command ``oktavia-search``. First parameter of this command is a search index file. Remained parameters are search words.

.. image:: search-result.png

